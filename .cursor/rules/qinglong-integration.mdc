---
description: 青龙面板API集成开发指南
---

# 青龙面板API集成指南

## QLHelper类设计原则
青龙面板API有版本差异，需要兼容处理：
- 新版本使用`_id`字段作为主键
- 旧版本使用`id`字段作为主键
- 通过`check_id_field()`方法自动检测

## API认证流程
```python
# 1. 获取Token
/open/auth/token?client_id={client_id}&client_secret={client_secret}

# 2. 使用Token访问API
headers = {'Authorization': f'{token_type} {token}'}
```

## 环境变量操作
### 查询环境变量
- 使用`searchValue`参数精确查找
- 返回结果中的ID字段可能是`id`或`_id`

### 新增环境变量
```python
payload = [{'name': 'JD_COOKIE', 'value': cookie_value, 'remarks': remarks}]
```

### 更新环境变量
```python
payload = {'name': name, 'value': value, 'remarks': remarks, id_field: env_id}
```

### 启用环境变量
```python
payload = [env_id]  # 注意是数组格式
```

## 错误处理
- 网络请求设置timeout=10秒
- 检查响应状态码和业务状态码
- 记录详细错误信息便于调试

## Cookie格式要求
京东Cookie格式：`pt_key=xxx;pt_pin=xxx;`
- pt_key: 用户认证密钥
- pt_pin: 用户标识符
- 用pt_pin作为环境变量搜索条件

## 备注信息规范
使用`from_macos_tool_{pin}`格式标识来源，便于管理和追踪。